#!/usr/bin/make -f

# Ensure the Rust environment is available
export PATH := $(HOME)/.cargo/bin:$(PATH)

%:
	dh $@

override_dh_auto_clean:
	. $(HOME)/.cargo/env && rustup default stable && cargo clean

override_dh_auto_build:
	. $(HOME)/.cargo/env && rustup default stable && cargo build --release
	strip --strip-unneeded target/release/himmelblaud
	strip --strip-unneeded target/release/himmelblaud_tasks
	cp target/release/libnss_himmelblau.so target/release/libnss_himmelblau.so.2
	cp target/release/libpam_himmelblau.so target/release/pam_himmelblau.so
	patchelf --set-soname libnss_himmelblau.so.2 target/release/libnss_himmelblau.so.2
	strip --strip-unneeded target/release/libnss_himmelblau.so.2
	strip --strip-unneeded target/release/libpam_himmelblau.so

override_dh_auto_test:
	# Skip tests
